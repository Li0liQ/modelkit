{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 45682ac05c2a6c99a63a","webpack:///external \"lodash/map\"","webpack:///./src/loaders/modelkit-base-loader.js","webpack:///external \"lodash/filter\"","webpack:///external \"lodash/forEach\"","webpack:///external \"fs\"","webpack:///external \"lodash/isPlainObject\"","webpack:///external \"lodash/reduce\"","webpack:///external \"path\"","webpack:///./src/loaders/index.js","webpack:///./src/modelkit.js","webpack:///./src/plugins/index.js","webpack:///./src/index.js","webpack:///./src/loaders/modelkit-js-loader.js","webpack:///./src/loaders/modelkit-json-loader.js","webpack:///./src/loaders/modelkit-yarn-loader.js","webpack:///./src/plugins/modelkit-manifest-plugin.js","webpack:///./src/utils/flag-utils.js","webpack:///external \"escape-string-regexp\"","webpack:///external \"grasp\"","webpack:///external \"lodash/each\"","webpack:///external \"lodash/flatten\"","webpack:///external \"lodash/isFunction\"","webpack:///external \"lodash/union\"","webpack:///external \"mkdirp\"","webpack:///external \"yarn/lib/lockfile/parse\"","webpack:///external \"yarn/lib/lockfile/stringify\""],"names":["BaseLoader","config","test","RegExp","files","join","default","Modelkit","context","triggerPluginsMethod","readFiles","assignLoadersToFiles","loaders","readFileFlags","flags","getAllFlags","flagPermutations","freezeFlags","flagPermutationDirectories","flagObj","flagIndex","getDirectoryByFlag","outputDir","applyFlagsToAllFilesAndWrite","methodName","plugins","plugin","flagCopy","Object","assign","flagDirectory","file","loader","source","getFileSourceWithFlags","writeFileSync","fileName","result","flagDirName","replace","filePathList","readdirSync","inputDir","statSync","filePath","isFile","fileList","readFileSync","basename","Error","JsLoader","flagFunction","functionSearchPattern","foundResult","search","i","arguments","value","getRaw","node","JSON","stringify","deleteProperty","obj","pattern","key","subObj","updateProperty","JsonLoader","changes","flag","json","parse","agg","delete","update","YarnLoader","ManifestPlugin","featureFlagsToDirectoryMap","directory","getFlagBits","flagList","flagBits","length","getBooleanFlagPermutations","currentFlags","resultList","changeFlagByIndex","push","sortFlags"],"mappings":"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","file":"modelkit.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash/map\"), require(\"lodash/filter\"), require(\"lodash/forEach\"), require(\"fs\"), require(\"lodash/isPlainObject\"), require(\"lodash/reduce\"), require(\"path\"), require(\"escape-string-regexp\"), require(\"grasp\"), require(\"lodash/each\"), require(\"lodash/flatten\"), require(\"lodash/isFunction\"), require(\"lodash/union\"), require(\"mkdirp\"), require(\"yarn/lib/lockfile/parse\"), require(\"yarn/lib/lockfile/stringify\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"modelkit\", [\"lodash/map\", \"lodash/filter\", \"lodash/forEach\", \"fs\", \"lodash/isPlainObject\", \"lodash/reduce\", \"path\", \"escape-string-regexp\", \"grasp\", \"lodash/each\", \"lodash/flatten\", \"lodash/isFunction\", \"lodash/union\", \"mkdirp\", \"yarn/lib/lockfile/parse\", \"yarn/lib/lockfile/stringify\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"modelkit\"] = factory(require(\"lodash/map\"), require(\"lodash/filter\"), require(\"lodash/forEach\"), require(\"fs\"), require(\"lodash/isPlainObject\"), require(\"lodash/reduce\"), require(\"path\"), require(\"escape-string-regexp\"), require(\"grasp\"), require(\"lodash/each\"), require(\"lodash/flatten\"), require(\"lodash/isFunction\"), require(\"lodash/union\"), require(\"mkdirp\"), require(\"yarn/lib/lockfile/parse\"), require(\"yarn/lib/lockfile/stringify\"));\n\telse\n\t\troot[\"modelkit\"] = factory(root[\"lodash/map\"], root[\"lodash/filter\"], root[\"lodash/forEach\"], root[\"fs\"], root[\"lodash/isPlainObject\"], root[\"lodash/reduce\"], root[\"path\"], root[\"escape-string-regexp\"], root[\"grasp\"], root[\"lodash/each\"], root[\"lodash/flatten\"], root[\"lodash/isFunction\"], root[\"lodash/union\"], root[\"mkdirp\"], root[\"yarn/lib/lockfile/parse\"], root[\"yarn/lib/lockfile/stringify\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_4__, __WEBPACK_EXTERNAL_MODULE_5__, __WEBPACK_EXTERNAL_MODULE_6__, __WEBPACK_EXTERNAL_MODULE_7__, __WEBPACK_EXTERNAL_MODULE_17__, __WEBPACK_EXTERNAL_MODULE_18__, __WEBPACK_EXTERNAL_MODULE_19__, __WEBPACK_EXTERNAL_MODULE_20__, __WEBPACK_EXTERNAL_MODULE_21__, __WEBPACK_EXTERNAL_MODULE_22__, __WEBPACK_EXTERNAL_MODULE_23__, __WEBPACK_EXTERNAL_MODULE_24__, __WEBPACK_EXTERNAL_MODULE_25__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 11);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 45682ac05c2a6c99a63a","module.exports = require(\"lodash/map\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/map\"\n// module id = 0\n// module chunks = 0","import * as _ from 'lodash';\r\nimport escapeRegex from 'escape-string-regexp';\r\n\r\nexport default class BaseLoader {\r\n    constructor(config) {\r\n        if (config.test) {\r\n            this.test = config.test;\r\n        } else {\r\n            this.test = new RegExp(_.map(config.files, escapeRegex).join('|'));\r\n        }\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/modelkit-base-loader.js","module.exports = require(\"lodash/filter\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/filter\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"lodash/forEach\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/forEach\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"lodash/isPlainObject\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isPlainObject\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"lodash/reduce\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/reduce\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 7\n// module chunks = 0","export { default as ModelkitJsonLoader } from './modelkit-json-loader';\r\nexport { default as ModelkitJsLoader } from './modelkit-js-loader';\r\nexport { default as ModelkitYarnLoader } from './modelkit-yarn-loader';\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/index.js","import * as _ from 'lodash';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\nimport mkdirp from 'mkdirp';\r\nimport { getBooleanFlagPermutations, sortFlags } from './utils/flag-utils';\r\n\r\nexport default class Modelkit {\r\n    run(config) {\r\n        const context = {\r\n            config,\r\n        };\r\n\r\n        this.triggerPluginsMethod('beforeStart', context);\r\n\r\n        context.files = this.readFiles(config);\r\n        this.assignLoadersToFiles(config.loaders, context.files);\r\n        this.readFileFlags(context.files);\r\n\r\n        context.flags = this.getAllFlags(context.files);\r\n\r\n        // Extract permutations into a plugin. Maybe.\r\n        context.flagPermutations = sortFlags(\r\n            getBooleanFlagPermutations(context.flags, config.freezeFlags),\r\n        );\r\n\r\n        context.flagPermutationDirectories = _.map(\r\n            context.flagPermutations,\r\n            (flagObj, flagIndex) => this.getDirectoryByFlag({ flagObj, flagIndex, config }),\r\n        );\r\n\r\n        mkdirp(config.outputDir);\r\n\r\n        this.applyFlagsToAllFilesAndWrite(config, context);\r\n\r\n        this.triggerPluginsMethod('afterEnd', context);\r\n    }\r\n\r\n    triggerPluginsMethod(methodName, context) {\r\n        _.forEach(context.plugins, (plugin) => {\r\n            if (_.isFunction(plugin[methodName])) {\r\n                plugin[methodName](context);\r\n            }\r\n        });\r\n    }\r\n\r\n    applyFlagsToAllFilesAndWrite(config, context) {\r\n        _.forEach(context.flagPermutations, (flagObj, flagIndex) => {\r\n            const flagCopy = Object.assign({}, flagObj);\r\n            // TODO: allow plugins to provide additional replacements in filename\r\n            const flagDirectory = this.getDirectoryByFlag({ flagObj, flagIndex, config });\r\n            const outputDir = path.join(config.outputDir, flagDirectory);\r\n\r\n            mkdirp(outputDir);\r\n\r\n            _.forEach(context.files, (file) => {\r\n                if (file.loader) {\r\n                    file.source = file.loader.getFileSourceWithFlags(file, flagCopy);\r\n                }\r\n\r\n                fs.writeFileSync(\r\n                    path.join(outputDir, file.fileName),\r\n                    file.source,\r\n                );\r\n            });\r\n        });\r\n    }\r\n\r\n    getDirectoryByFlag({ flagIndex, config }) {\r\n        // TODO: allow plugins to provide additional replacements in filename\r\n        const result = config.flagDirName.replace('[id]', flagIndex);\r\n        return result;\r\n    }\r\n\r\n    readFileFlags(files) {\r\n        _.each(files, (file) => {\r\n            if (file.loader) {\r\n                file.flags = file.loader.readFileFlags(file);\r\n            }\r\n        });\r\n    }\r\n\r\n    getAllFlags(files) {\r\n        // we support only boolean flags for now\r\n        // hence union and returning flag names only works fine\r\n        const flags = _.union(_.flatten(_.map(files, file => file.flags)));\r\n        return flags;\r\n    }\r\n\r\n    readFiles(config) {\r\n        const filePathList = _.filter(\r\n            _.map(\r\n                fs.readdirSync(config.inputDir),\r\n                fileName => path.join(config.inputDir, fileName),\r\n            ),\r\n            filePath => fs.statSync(filePath).isFile(),\r\n        );\r\n\r\n        const fileList = _.map(filePathList, (filePath) => {\r\n            const source = fs.readFileSync(filePath, 'utf8');\r\n            const fileName = path.basename(filePath);\r\n\r\n            return {\r\n                fileName,\r\n                filePath,\r\n                source,\r\n            };\r\n        });\r\n\r\n        return fileList;\r\n    }\r\n\r\n    assignLoadersToFiles(loaders, files) {\r\n        _.each(files, file => _.each(loaders, (loader) => {\r\n            if (loader.test.test(file.fileName)) {\r\n                if (file.loader) {\r\n                    throw new Error(`File ${file.fileName} has more than one loader matching it. Please, fix config.`);\r\n                }\r\n\r\n                file.loader = loader;\r\n            }\r\n        }));\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/modelkit.js","export { default as ModelkitManifestPlugin } from './modelkit-manifest-plugin';\n\n\n\n// WEBPACK FOOTER //\n// ./src/plugins/index.js","export { default } from './modelkit';\r\nexport * from './plugins';\r\nexport * from './loaders';\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import * as _ from 'lodash';\r\nimport grasp from 'grasp';\r\nimport BaseLoader from './modelkit-base-loader';\r\n\r\nexport default class JsLoader extends BaseLoader {\r\n    constructor(config) {\r\n        super(config);\r\n        this.flagFunction = config.flagFunction;\r\n    }\r\n\r\n    readFileFlags(file) {\r\n        const functionSearchPattern = `${this.flagFunction}(_str, _bool)`;\r\n        const foundResult = grasp.search('equery', functionSearchPattern, file.source);\r\n        const flags = _.map(foundResult, i => i.arguments[0].value);\r\n\r\n        return flags;\r\n    }\r\n\r\n    getFileSourceWithFlags(file, flags) {\r\n        const functionSearchPattern = `${this.flagFunction}(_str, _bool)`;\r\n        const result = grasp.replace('equery', functionSearchPattern,\r\n            (getRaw, node) => JSON.stringify(flags[node.arguments[0].value]),\r\n            file.source,\r\n        );\r\n\r\n        return result;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/modelkit-js-loader.js","import * as _ from 'lodash';\r\nimport BaseLoader from './modelkit-base-loader';\r\n\r\n// No array support atm.\r\nconst deleteProperty = (obj, pattern) => {\r\n    _.forEach(pattern, (value, key) => {\r\n        const subObj = obj[key];\r\n\r\n        if (typeof subObj === 'undefined') {\r\n            return;\r\n        }\r\n\r\n        if (_.isPlainObject(value) && _.isPlainObject(subObj)) {\r\n            deleteProperty(subObj, value);\r\n        } else {\r\n            delete obj[key];\r\n        }\r\n    });\r\n};\r\n\r\nconst updateProperty = (obj, pattern) => {\r\n    _.forEach(pattern, (value, key) => {\r\n        const subObj = obj[key];\r\n\r\n        if (typeof subObj === 'undefined') {\r\n            obj[key] = value;\r\n\r\n            return;\r\n        }\r\n\r\n        if (_.isPlainObject(value) && _.isPlainObject(subObj)) {\r\n            updateProperty(subObj, value);\r\n        } else {\r\n            obj[key] = value;\r\n        }\r\n    });\r\n};\r\n\r\nexport default class JsonLoader extends BaseLoader {\r\n    constructor(config) {\r\n        super(config);\r\n        this.changes = config.changes;\r\n    }\r\n\r\n    readFileFlags() {\r\n        const flags = _.map(this.changes, i => i.flag);\r\n\r\n        return flags;\r\n    }\r\n\r\n    getFileSourceWithFlags(file, flags) {\r\n        let json = JSON.parse(file.source);\r\n\r\n        json = _.reduce(flags, (agg, value, key) => {\r\n            if (!value) {\r\n                return agg;\r\n            }\r\n\r\n            const changes = _.filter(this.changes, i => i.flag === key)[0];\r\n\r\n            if (typeof changes === 'undefined') {\r\n                return agg;\r\n            }\r\n\r\n            if (changes.delete) {\r\n                deleteProperty(agg, changes.delete);\r\n            }\r\n\r\n            if (changes.update) {\r\n                updateProperty(agg, changes.update);\r\n            }\r\n\r\n            return agg;\r\n        }, json);\r\n\r\n        const result = JSON.stringify(json, null, 2);\r\n\r\n        return result;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/modelkit-json-loader.js","import * as _ from 'lodash';\r\nimport parse from 'yarn/lib/lockfile/parse';\r\nimport stringify from 'yarn/lib/lockfile/stringify';\r\nimport BaseLoader from './modelkit-base-loader';\r\n\r\n// No array support atm.\r\nconst deleteProperty = (obj, pattern) => {\r\n    _.forEach(pattern, (value, key) => {\r\n        const subObj = obj[key];\r\n\r\n        if (typeof subObj === 'undefined') {\r\n            return;\r\n        }\r\n\r\n        if (_.isPlainObject(value) && _.isPlainObject(subObj)) {\r\n            deleteProperty(subObj, value);\r\n        } else {\r\n            delete obj[key];\r\n        }\r\n    });\r\n};\r\n\r\nconst updateProperty = (obj, pattern) => {\r\n    _.forEach(pattern, (value, key) => {\r\n        const subObj = obj[key];\r\n\r\n        if (typeof subObj === 'undefined') {\r\n            obj[key] = value;\r\n\r\n            return;\r\n        }\r\n\r\n        if (_.isPlainObject(value) && _.isPlainObject(subObj)) {\r\n            updateProperty(subObj, value);\r\n        } else {\r\n            obj[key] = value;\r\n        }\r\n    });\r\n};\r\n\r\nexport default class YarnLoader extends BaseLoader{\r\n    constructor(config) {\r\n        super(config);\r\n        this.changes = config.changes;\r\n    }\r\n\r\n    readFileFlags() {\r\n        const flags = _.map(this.changes, i => i.flag);\r\n\r\n        return flags;\r\n    }\r\n\r\n    getFileSourceWithFlags(file, flags) {\r\n        const source = file.source.replace(/\\r\\n/g, '\\n'); // important for yarn parser\r\n        let json = parse(source, file.filePath);\r\n\r\n        json = _.reduce(flags, (agg, value, key) => {\r\n            if (!value) {\r\n                return agg;\r\n            }\r\n\r\n            const changes = _.filter(this.changes, i => i.flag === key)[0];\r\n\r\n            if (typeof changes === 'undefined') {\r\n                return agg;\r\n            }\r\n\r\n            if (changes.delete) {\r\n                deleteProperty(agg, changes.delete);\r\n            }\r\n\r\n            if (changes.update) {\r\n                updateProperty(agg, changes.update);\r\n            }\r\n\r\n            return agg;\r\n        }, json);\r\n\r\n        const result = stringify(json, false);\r\n\r\n        return result;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/modelkit-yarn-loader.js","import * as _ from 'lodash';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\nexport default class ManifestPlugin {\r\n    constructor(config) {\r\n        this.config = config;\r\n    }\r\n\r\n    afterEnd(context) {\r\n        const featureFlagsToDirectoryMap = _.map(context.flagPermutations, (flagObj, flagIndex) =>\r\n            ({\r\n                flags: flagObj,\r\n                directory: context.flagPermutationDirectories[flagIndex],\r\n            }),\r\n        );\r\n\r\n        fs.writeFileSync(\r\n            path.join(context.config.outputDir, this.config.file),\r\n            JSON.stringify(featureFlagsToDirectoryMap, null, 2),\r\n        );\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/plugins/modelkit-manifest-plugin.js","export const getFlagBits = (flagList, flags) => {\r\n    let flagBits = 0;\r\n\r\n    for (let i = 0; i < flagList.length; i += 1) {\r\n        if (flags[flagList[i]]) {\r\n            /* eslint-disable no-bitwise */\r\n            flagBits += 1 << i;\r\n        }\r\n    }\r\n\r\n    return flagBits;\r\n};\r\n\r\nexport const getBooleanFlagPermutations = (flagList, freezeFlags = {}) => {\r\n    const currentFlags = Object.assign({}, freezeFlags);\r\n    const resultList = [];\r\n\r\n    const changeFlagByIndex = (flagIndex) => {\r\n        if (flagIndex >= flagList.length) {\r\n            resultList.push(Object.assign({}, currentFlags));\r\n        } else {\r\n            const flag = flagList[flagIndex];\r\n            if (typeof freezeFlags[flag] !== 'undefined') {\r\n                changeFlagByIndex(flagIndex + 1);\r\n            } else {\r\n                currentFlags[flag] = false;\r\n                changeFlagByIndex(flagIndex + 1);\r\n                currentFlags[flag] = true;\r\n                changeFlagByIndex(flagIndex + 1);\r\n            }\r\n        }\r\n    };\r\n\r\n    changeFlagByIndex(0);\r\n\r\n    return resultList;\r\n};\r\n\r\n// TODO: sort flags\r\nexport const sortFlags = i => i;\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/flag-utils.js","module.exports = require(\"escape-string-regexp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"escape-string-regexp\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"grasp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"grasp\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"lodash/each\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/each\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"lodash/flatten\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/flatten\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"lodash/isFunction\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isFunction\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"lodash/union\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/union\"\n// module id = 22\n// module chunks = 0","module.exports = require(\"mkdirp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mkdirp\"\n// module id = 23\n// module chunks = 0","module.exports = require(\"yarn/lib/lockfile/parse\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"yarn/lib/lockfile/parse\"\n// module id = 24\n// module chunks = 0","module.exports = require(\"yarn/lib/lockfile/stringify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"yarn/lib/lockfile/stringify\"\n// module id = 25\n// module chunks = 0"],"sourceRoot":""}