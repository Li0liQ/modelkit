{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 2fe75166d06b4c551c65","webpack:///external \"lodash/map\"","webpack:///external \"escape-string-regexp\"","webpack:///external \"lodash/filter\"","webpack:///external \"lodash/forEach\"","webpack:///external \"lodash/reduce\"","webpack:///external \"fs\"","webpack:///external \"lodash/isPlainObject\"","webpack:///external \"path\"","webpack:///./src/loaders/index.js","webpack:///./src/modelkit.js","webpack:///./src/plugins/index.js","webpack:///./src/index.js","webpack:///./src/loaders/modelkit-js-loader.js","webpack:///./src/loaders/modelkit-json-loader.js","webpack:///./src/loaders/modelkit-yarn-loader.js","webpack:///./src/plugins/modelkit-freeze-plugin.js","webpack:///./src/plugins/modelkit-manifest-plugin.js","webpack:///./src/utils/flag-utils.js","webpack:///external \"grasp\"","webpack:///external \"lodash/each\"","webpack:///external \"lodash/flatten\"","webpack:///external \"lodash/union\"","webpack:///external \"mkdirp\"","webpack:///external \"yarn/lib/lockfile/parse\"","webpack:///external \"yarn/lib/lockfile/stringify\"","webpack:///./src/loaders/modelkit-base-loader.js"],"names":["default","Modelkit","config","context","files","readFiles","assignLoadersToFiles","loaders","readFileFlags","flags","getAllFlags","freezeFlags","getFreezeFlags","plugins","flagPermutations","flagPermutationDirectories","flagObj","flagIndex","getDirectoryByFlag","outputDir","filter","i","getManifest","applyFlagsToAllFilesAndWrite","flagCopy","Object","assign","flagDirectory","join","file","loader","source","getFileSourceWithFlags","writeFileSync","fileName","result","flagDirName","replace","filePathList","readdirSync","inputDir","statSync","filePath","isFile","fileList","readFileSync","basename","input","uniqueFreezeFlags","agg","test","Error","JsLoader","flagFunction","functionSearchPattern","foundResult","search","arguments","value","getRaw","node","JSON","stringify","deleteProperty","obj","pattern","key","subObj","updateProperty","JsonLoader","changes","flag","json","parse","delete","update","YarnLoader","FreezePlugin","ManifestPlugin","state","featureFlagsToDirectoryMap","directory","getFlagBits","flagList","flagBits","length","getBooleanFlagPermutations","currentFlags","resultList","changeFlagByIndex","push","sortFlags","BaseLoader","RegExp"],"mappings":"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","file":"modelkit.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash/map\"), require(\"escape-string-regexp\"), require(\"lodash/filter\"), require(\"lodash/forEach\"), require(\"lodash/reduce\"), require(\"fs\"), require(\"lodash/isPlainObject\"), require(\"path\"), require(\"grasp\"), require(\"lodash/each\"), require(\"lodash/flatten\"), require(\"lodash/union\"), require(\"mkdirp\"), require(\"yarn/lib/lockfile/parse\"), require(\"yarn/lib/lockfile/stringify\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"modelkit\", [\"lodash/map\", \"escape-string-regexp\", \"lodash/filter\", \"lodash/forEach\", \"lodash/reduce\", \"fs\", \"lodash/isPlainObject\", \"path\", \"grasp\", \"lodash/each\", \"lodash/flatten\", \"lodash/union\", \"mkdirp\", \"yarn/lib/lockfile/parse\", \"yarn/lib/lockfile/stringify\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"modelkit\"] = factory(require(\"lodash/map\"), require(\"escape-string-regexp\"), require(\"lodash/filter\"), require(\"lodash/forEach\"), require(\"lodash/reduce\"), require(\"fs\"), require(\"lodash/isPlainObject\"), require(\"path\"), require(\"grasp\"), require(\"lodash/each\"), require(\"lodash/flatten\"), require(\"lodash/union\"), require(\"mkdirp\"), require(\"yarn/lib/lockfile/parse\"), require(\"yarn/lib/lockfile/stringify\"));\n\telse\n\t\troot[\"modelkit\"] = factory(root[\"lodash/map\"], root[\"escape-string-regexp\"], root[\"lodash/filter\"], root[\"lodash/forEach\"], root[\"lodash/reduce\"], root[\"fs\"], root[\"lodash/isPlainObject\"], root[\"path\"], root[\"grasp\"], root[\"lodash/each\"], root[\"lodash/flatten\"], root[\"lodash/union\"], root[\"mkdirp\"], root[\"yarn/lib/lockfile/parse\"], root[\"yarn/lib/lockfile/stringify\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_4__, __WEBPACK_EXTERNAL_MODULE_5__, __WEBPACK_EXTERNAL_MODULE_6__, __WEBPACK_EXTERNAL_MODULE_7__, __WEBPACK_EXTERNAL_MODULE_18__, __WEBPACK_EXTERNAL_MODULE_19__, __WEBPACK_EXTERNAL_MODULE_20__, __WEBPACK_EXTERNAL_MODULE_21__, __WEBPACK_EXTERNAL_MODULE_22__, __WEBPACK_EXTERNAL_MODULE_23__, __WEBPACK_EXTERNAL_MODULE_24__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 11);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 2fe75166d06b4c551c65","module.exports = require(\"lodash/map\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/map\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"escape-string-regexp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"escape-string-regexp\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"lodash/filter\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/filter\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"lodash/forEach\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/forEach\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"lodash/reduce\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/reduce\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"lodash/isPlainObject\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isPlainObject\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 7\n// module chunks = 0","export { default as ModelkitJsonLoader } from './modelkit-json-loader';\r\nexport { default as ModelkitJsLoader } from './modelkit-js-loader';\r\nexport { default as ModelkitYarnLoader } from './modelkit-yarn-loader';\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/index.js","import * as _ from 'lodash';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\nimport mkdirp from 'mkdirp';\r\nimport { getBooleanFlagPermutations, sortFlags } from './utils/flag-utils';\r\n\r\nexport default class Modelkit {\r\n    run(config) {\r\n        const context = {\r\n            config,\r\n        };\r\n\r\n        context.files = this.readFiles(config);\r\n        this.assignLoadersToFiles(config.loaders, context.files);\r\n        this.readFileFlags(context.files);\r\n\r\n        context.flags = this.getAllFlags(context.files);\r\n\r\n        // Extract permutations into a plugin.\r\n        const freezeFlags = this.getFreezeFlags(config.plugins);\r\n        context.flagPermutations = sortFlags(\r\n            getBooleanFlagPermutations(context.flags, freezeFlags),\r\n        );\r\n        context.flagPermutationDirectories = _.map(\r\n            context.flagPermutations,\r\n            (flagObj, flagIndex) => this.getDirectoryByFlag({ flagObj, flagIndex, config }),\r\n        );\r\n\r\n        mkdirp(config.outputDir);\r\n\r\n        _.forEach(_.filter(config.plugins.filter(i => i.getManifest)), i => i.getManifest(context));\r\n\r\n        this.applyFlagsToAllFilesAndWrite(config, context);\r\n    }\r\n\r\n    applyFlagsToAllFilesAndWrite(config, context) {\r\n        _.forEach(context.flagPermutations, (flagObj, flagIndex) => {\r\n            const flagCopy = Object.assign({}, flagObj);\r\n            // TODO: allow plugins to provide additional replacements in filename\r\n            const flagDirectory = this.getDirectoryByFlag({ flagObj, flagIndex, config });\r\n            const outputDir = path.join(config.outputDir, flagDirectory);\r\n\r\n            mkdirp(outputDir);\r\n\r\n            _.forEach(context.files, (file) => {\r\n                if (file.loader) {\r\n                    file.source = file.loader.getFileSourceWithFlags(file, flagCopy);\r\n                }\r\n\r\n                fs.writeFileSync(\r\n                    path.join(outputDir, file.fileName),\r\n                    file.source,\r\n                );\r\n            });\r\n        });\r\n    }\r\n\r\n    getDirectoryByFlag({ flagIndex, config }) {\r\n        // TODO: allow plugins to provide additional replacements in filename\r\n        const result = config.flagDirName.replace('[id]', flagIndex);\r\n        return result;\r\n    }\r\n\r\n    readFileFlags(files) {\r\n        _.each(files, (file) => {\r\n            if (file.loader) {\r\n                file.flags = file.loader.readFileFlags(file);\r\n            }\r\n        });\r\n    }\r\n\r\n    getAllFlags(files) {\r\n        // we support only boolean flags for now\r\n        // hence union and returning flag names only works fine\r\n        const flags = _.union(_.flatten(_.map(files, file => file.flags)));\r\n        return flags;\r\n    }\r\n\r\n    readFiles(config) {\r\n        const filePathList = _.filter(\r\n            _.map(\r\n                fs.readdirSync(config.inputDir),\r\n                fileName => path.join(config.inputDir, fileName),\r\n            ),\r\n            filePath => fs.statSync(filePath).isFile(),\r\n        );\r\n\r\n        const fileList = _.map(filePathList, (filePath) => {\r\n            const source = fs.readFileSync(filePath, 'utf8');\r\n            const fileName = path.basename(filePath);\r\n\r\n            return {\r\n                fileName,\r\n                filePath,\r\n                source,\r\n            };\r\n        });\r\n\r\n        return fileList;\r\n    }\r\n\r\n    getFreezeFlags(input) {\r\n        // TODO: check if there are different values assigned for the same flags.\r\n        // Throw if there are.\r\n        const freezeFlags = _.map(_.filter(input, i => i.getFreezeFlags), i => i.getFreezeFlags());\r\n\r\n        const uniqueFreezeFlags = _.reduce(\r\n            freezeFlags,\r\n            (agg, i) => Object.assign(agg, i),\r\n            {},\r\n        );\r\n\r\n        return uniqueFreezeFlags;\r\n    }\r\n\r\n    assignLoadersToFiles(loaders, files) {\r\n        _.each(files, file => _.each(loaders, (loader) => {\r\n            if (loader.test.test(file.fileName)) {\r\n                if (file.loader) {\r\n                    throw new Error(`File ${file.fileName} has more than one loader matching it. Please, fix config.`);\r\n                }\r\n\r\n                file.loader = loader;\r\n            }\r\n        }));\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/modelkit.js","export { default as ModelkitFreezePlugin } from './modelkit-freeze-plugin';\nexport { default as ModelkitManifestPlugin } from './modelkit-manifest-plugin';\n\n\n\n// WEBPACK FOOTER //\n// ./src/plugins/index.js","export { default } from './modelkit';\r\nexport * from './plugins';\r\nexport * from './loaders';\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import * as _ from 'lodash';\r\nimport grasp from 'grasp';\r\nimport BaseLoader from './modelkit-base-loader';\r\n\r\nexport default class JsLoader extends BaseLoader {\r\n    constructor(config) {\r\n        super(config);\r\n        this.flagFunction = config.flagFunction;\r\n    }\r\n\r\n    readFileFlags(file) {\r\n        const functionSearchPattern = `${this.flagFunction}(_str, _bool)`;\r\n        const foundResult = grasp.search('equery', functionSearchPattern, file.source);\r\n        const flags = _.map(foundResult, i => i.arguments[0].value);\r\n\r\n        return flags;\r\n    }\r\n\r\n    getFileSourceWithFlags(file, flags) {\r\n        const functionSearchPattern = `${this.flagFunction}(_str, _bool)`;\r\n        const result = grasp.replace('equery', functionSearchPattern,\r\n            (getRaw, node) => JSON.stringify(flags[node.arguments[0].value]),\r\n            file.source,\r\n        );\r\n\r\n        return result;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/modelkit-js-loader.js","import * as _ from 'lodash';\r\nimport BaseLoader from './modelkit-base-loader';\r\n\r\n// No array support atm.\r\nconst deleteProperty = (obj, pattern) => {\r\n    _.forEach(pattern, (value, key) => {\r\n        const subObj = obj[key];\r\n\r\n        if (typeof subObj === 'undefined') {\r\n            return;\r\n        }\r\n\r\n        if (_.isPlainObject(value) && _.isPlainObject(subObj)) {\r\n            deleteProperty(subObj, value);\r\n        } else {\r\n            delete obj[key];\r\n        }\r\n    });\r\n};\r\n\r\nconst updateProperty = (obj, pattern) => {\r\n    _.forEach(pattern, (value, key) => {\r\n        const subObj = obj[key];\r\n\r\n        if (typeof subObj === 'undefined') {\r\n            obj[key] = value;\r\n\r\n            return;\r\n        }\r\n\r\n        if (_.isPlainObject(value) && _.isPlainObject(subObj)) {\r\n            updateProperty(subObj, value);\r\n        } else {\r\n            obj[key] = value;\r\n        }\r\n    });\r\n};\r\n\r\nexport default class JsonLoader extends BaseLoader {\r\n    constructor(config) {\r\n        super(config);\r\n        this.changes = config.changes;\r\n    }\r\n\r\n    readFileFlags() {\r\n        const flags = _.map(this.changes, i => i.flag);\r\n\r\n        return flags;\r\n    }\r\n\r\n    getFileSourceWithFlags(file, flags) {\r\n        let json = JSON.parse(file.source);\r\n\r\n        json = _.reduce(flags, (agg, value, key) => {\r\n            if (!value) {\r\n                return agg;\r\n            }\r\n\r\n            const changes = _.filter(this.changes, i => i.flag === key)[0];\r\n\r\n            if (typeof changes === 'undefined') {\r\n                return agg;\r\n            }\r\n\r\n            if (changes.delete) {\r\n                deleteProperty(agg, changes.delete);\r\n            }\r\n\r\n            if (changes.update) {\r\n                updateProperty(agg, changes.update);\r\n            }\r\n\r\n            return agg;\r\n        }, json);\r\n\r\n        const result = JSON.stringify(json, null, 2);\r\n\r\n        return result;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/modelkit-json-loader.js","import * as _ from 'lodash';\r\nimport parse from 'yarn/lib/lockfile/parse';\r\nimport stringify from 'yarn/lib/lockfile/stringify';\r\nimport BaseLoader from './modelkit-base-loader';\r\n\r\n// No array support atm.\r\nconst deleteProperty = (obj, pattern) => {\r\n    _.forEach(pattern, (value, key) => {\r\n        const subObj = obj[key];\r\n\r\n        if (typeof subObj === 'undefined') {\r\n            return;\r\n        }\r\n\r\n        if (_.isPlainObject(value) && _.isPlainObject(subObj)) {\r\n            deleteProperty(subObj, value);\r\n        } else {\r\n            delete obj[key];\r\n        }\r\n    });\r\n};\r\n\r\nconst updateProperty = (obj, pattern) => {\r\n    _.forEach(pattern, (value, key) => {\r\n        const subObj = obj[key];\r\n\r\n        if (typeof subObj === 'undefined') {\r\n            obj[key] = value;\r\n\r\n            return;\r\n        }\r\n\r\n        if (_.isPlainObject(value) && _.isPlainObject(subObj)) {\r\n            updateProperty(subObj, value);\r\n        } else {\r\n            obj[key] = value;\r\n        }\r\n    });\r\n};\r\n\r\nexport default class YarnLoader extends BaseLoader{\r\n    constructor(config) {\r\n        super(config);\r\n        this.changes = config.changes;\r\n    }\r\n\r\n    readFileFlags() {\r\n        const flags = _.map(this.changes, i => i.flag);\r\n\r\n        return flags;\r\n    }\r\n\r\n    getFileSourceWithFlags(file, flags) {\r\n        const source = file.source.replace(/\\r\\n/g, '\\n'); // important for yarn parser\r\n        let json = parse(source, file.filePath);\r\n\r\n        json = _.reduce(flags, (agg, value, key) => {\r\n            if (!value) {\r\n                return agg;\r\n            }\r\n\r\n            const changes = _.filter(this.changes, i => i.flag === key)[0];\r\n\r\n            if (typeof changes === 'undefined') {\r\n                return agg;\r\n            }\r\n\r\n            if (changes.delete) {\r\n                deleteProperty(agg, changes.delete);\r\n            }\r\n\r\n            if (changes.update) {\r\n                updateProperty(agg, changes.update);\r\n            }\r\n\r\n            return agg;\r\n        }, json);\r\n\r\n        const result = stringify(json, false);\r\n\r\n        return result;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/modelkit-yarn-loader.js","export default class FreezePlugin {\r\n    constructor(config) {\r\n        this.config = config;\r\n    }\r\n\r\n    getFreezeFlags() {\r\n        return this.config.flags;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/plugins/modelkit-freeze-plugin.js","import * as _ from 'lodash';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\nexport default class ManifestPlugin {\r\n    constructor(config) {\r\n        this.config = config;\r\n    }\r\n\r\n    getManifest(state) {\r\n        const featureFlagsToDirectoryMap = _.map(state.flagPermutations, (flagObj, flagIndex) =>\r\n            ({\r\n                flags: flagObj,\r\n                directory: state.flagPermutationDirectories[flagIndex],\r\n            }),\r\n        );\r\n\r\n        fs.writeFileSync(\r\n            path.join(state.config.outputDir, this.config.file),\r\n            JSON.stringify(featureFlagsToDirectoryMap, null, 2),\r\n        );\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/plugins/modelkit-manifest-plugin.js","export const getFlagBits = (flagList, flags) => {\r\n    let flagBits = 0;\r\n\r\n    for (let i = 0; i < flagList.length; i += 1) {\r\n        if (flags[flagList[i]]) {\r\n            /* eslint-disable no-bitwise */\r\n            flagBits += 1 << i;\r\n        }\r\n    }\r\n\r\n    return flagBits;\r\n};\r\n\r\nexport const getBooleanFlagPermutations = (flagList, freezeFlags = {}) => {\r\n    const currentFlags = Object.assign({}, freezeFlags);\r\n    const resultList = [];\r\n\r\n    const changeFlagByIndex = (flagIndex) => {\r\n        if (flagIndex >= flagList.length) {\r\n            resultList.push(Object.assign({}, currentFlags));\r\n        } else {\r\n            const flag = flagList[flagIndex];\r\n            if (typeof freezeFlags[flag] !== 'undefined') {\r\n                changeFlagByIndex(flagIndex + 1);\r\n            } else {\r\n                currentFlags[flag] = false;\r\n                changeFlagByIndex(flagIndex + 1);\r\n                currentFlags[flag] = true;\r\n                changeFlagByIndex(flagIndex + 1);\r\n            }\r\n        }\r\n    };\r\n\r\n    changeFlagByIndex(0);\r\n\r\n    return resultList;\r\n};\r\n\r\n// TODO: sort flags\r\nexport const sortFlags = i => i;\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/flag-utils.js","module.exports = require(\"grasp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"grasp\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"lodash/each\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/each\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"lodash/flatten\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/flatten\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"lodash/union\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/union\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"mkdirp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mkdirp\"\n// module id = 22\n// module chunks = 0","module.exports = require(\"yarn/lib/lockfile/parse\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"yarn/lib/lockfile/parse\"\n// module id = 23\n// module chunks = 0","module.exports = require(\"yarn/lib/lockfile/stringify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"yarn/lib/lockfile/stringify\"\n// module id = 24\n// module chunks = 0","import * as _ from 'lodash';\r\nimport escapeRegex from 'escape-string-regexp';\r\n\r\nexport default class BaseLoader {\r\n    constructor(config) {\r\n        if (config.test) {\r\n            this.test = config.test;\r\n        } else {\r\n            this.test = new RegExp(_.map(config.files, escapeRegex).join('|'));\r\n        }\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/modelkit-base-loader.js"],"sourceRoot":""}