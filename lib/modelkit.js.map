{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap eabb236badedc718f3f6","webpack:///external \"fs\"","webpack:///external \"lodash/forEach\"","webpack:///external \"lodash/map\"","webpack:///external \"path\"","webpack:///external \"lodash/reduce\"","webpack:///external \"lodash/filter\"","webpack:///external \"lodash/flatten\"","webpack:///external \"lodash/isPlainObject\"","webpack:///external \"lodash/union\"","webpack:///./src/loaders/index.js","webpack:///./src/modelkit.js","webpack:///./src/plugins/index.js","webpack:///./src/index.js","webpack:///./src/loaders/modelkit-js-loader.js","webpack:///./src/loaders/modelkit-json-loader.js","webpack:///./src/loaders/modelkit-yarn-loader.js","webpack:///./src/plugins/modelkit-freeze-plugin.js","webpack:///./src/utils/flag-utils.js","webpack:///external \"grasp\"","webpack:///external \"mkdirp\"","webpack:///external \"yarn/lib/lockfile/parse\"","webpack:///external \"yarn/lib/lockfile/stringify\"","webpack:///./src/plugins/modelkit-manifest-plugin.js"],"names":["default","Modelkit","config","state","files","readFiles","flags","getFlags","freezeFlags","getFreezeFlags","plugins","flagPermutations","flagPermutationDirectories","flagObj","flagIndex","getDirectoryByFlag","outputDir","filter","i","getManifest","applyFlagsToAllFiles","flagCopy","Object","assign","flagDirectory","join","input","result","flagDirName","replace","file","loader","inputDir","uniqueFreezeFlags","agg","JsLoader","functionSearchPattern","flagFunction","fileName","filePath","source","readFileSync","foundResult","search","arguments","value","fileObj","applyFlagsToFile","writeFileSync","getRaw","node","JSON","stringify","deleteProperty","obj","pattern","key","subObj","updateProperty","JsonLoader","changes","flag","json","parse","delete","update","YarnLoader","FreezePlugin","getFlagBits","flagList","flagBits","length","getBooleanFlagPermutations","currentFlags","resultList","changeFlagByIndex","push","sortFlags","ManifestPlugin","featureFlagsToDirectoryMap","directory"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;AChEA,+B;;;;;;ACAA,2C;;;;;;ACAA,uC;;;;;;ACAA,iC;;;;;;ACAA,0C;;;;;;ACAA,0C;;;;;;ACAA,2C;;;;;;ACAA,iD;;;;;;ACAA,yC;;;;;;;;;;;;;;;;;;uDCASA,O;;;;;;;;;qDACAA,O;;;;;;;;;uDACAA,O;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACDT;;;;AACA;;;;AACA;;;;AACA;;;;;;IAEqBC,Q;;;;;;;4BACbC,M,EAAQ;AAAA;;AACR,gBAAMC,QAAQ;AACVD;AADU,aAAd;;AAIA;AACAC,kBAAMC,KAAN,GAAc,KAAKC,SAAL,CAAeH,MAAf,CAAd;AACAC,kBAAMG,KAAN,GAAc,KAAKC,QAAL,CAAcJ,KAAd,CAAd;;AAEA;AACA,gBAAMK,cAAc,KAAKC,cAAL,CAAoBP,OAAOQ,OAA3B,CAApB;AACAP,kBAAMQ,gBAAN,GAAyB,0BAAU,2CAA2BR,MAAMG,KAAjC,EAAwCE,WAAxC,CAAV,CAAzB;AACAL,kBAAMS,0BAAN,GAAmC,mBAC/BT,MAAMQ,gBADyB,EAE/B,UAACE,OAAD,EAAUC,SAAV;AAAA,uBAAwB,MAAKC,kBAAL,CAAwB,EAAEF,gBAAF,EAAWC,oBAAX,EAAsBZ,cAAtB,EAAxB,CAAxB;AAAA,aAF+B,CAAnC;;AAKA,kCAAOA,OAAOc,SAAd;;AAEA,mCAAU,sBAASd,OAAOQ,OAAP,CAAeO,MAAf,CAAsB;AAAA,uBAAKC,EAAEC,WAAP;AAAA,aAAtB,CAAT,CAAV,EAA+D;AAAA,uBAAKD,EAAEC,WAAF,CAAchB,KAAd,CAAL;AAAA,aAA/D;;AAEA,mCAAUA,MAAMQ,gBAAhB,EAAkC,UAACE,OAAD,EAAUC,SAAV,EAAwB;AACtD,sBAAKM,oBAAL,CAA0B,EAAEP,gBAAF,EAAWC,oBAAX,EAAsBZ,cAAtB,EAA1B;AACH,aAFD;AAGH;;;mDAEoD;AAAA,gBAA9BW,OAA8B,QAA9BA,OAA8B;AAAA,gBAArBC,SAAqB,QAArBA,SAAqB;AAAA,gBAAVZ,MAAU,QAAVA,MAAU;;AACjD;AACA,gBAAMmB,WAAWC,OAAOC,MAAP,CAAc,EAAd,EAAkBV,OAAlB,CAAjB;AACA;AACA,gBAAMW,gBAAgB,KAAKT,kBAAL,CAAwB,EAAEF,gBAAF,EAAWC,oBAAX,EAAsBZ,cAAtB,EAAxB,CAAtB;AACA,gBAAMc,YAAY,eAAKS,IAAL,CAAUvB,OAAOc,SAAjB,EAA4BQ,aAA5B,CAAlB;;AAEA,kCAAOR,SAAP;AACA,mCAAUd,OAAOwB,KAAjB,EAAwB;AAAA,uBAAKR,EAAEE,oBAAF,CAAuBC,QAAvB,EAAiCL,SAAjC,CAAL;AAAA,aAAxB;AACH;;;kDAEyC;AAAA,gBAArBF,SAAqB,SAArBA,SAAqB;AAAA,gBAAVZ,MAAU,SAAVA,MAAU;;AACtC;AACA,gBAAMyB,SAASzB,OAAO0B,WAAP,CAAmBC,OAAnB,CAA2B,MAA3B,EAAmCf,SAAnC,CAAf;AACA,mBAAOa,MAAP;AACH;;;iCAEQxB,K,EAAO;AACZ;AACA;AACA,gBAAMG,QAAQ,qBAAQ,uBAAU,mBAAMH,MAAMC,KAAZ,EAAmB;AAAA,uBAAQ0B,KAAKxB,KAAb;AAAA,aAAnB,CAAV,CAAR,CAAd;AACA,mBAAOA,KAAP;AACH;;;kCAESJ,M,EAAQ;AACd,gBAAME,QAAQ,uBAAU,mBAAMF,OAAOwB,KAAb,EAAoB;AAAA,uBAAUK,OAAO1B,SAAP,CAAiBH,OAAO8B,QAAxB,CAAV;AAAA,aAApB,CAAV,CAAd;AACA,mBAAO5B,KAAP;AACH;;;uCAEcsB,K,EAAO;AAClB;AACA;AACA,gBAAMlB,cAAc,mBAAM,sBAASkB,KAAT,EAAgB;AAAA,uBAAKR,EAAET,cAAP;AAAA,aAAhB,CAAN,EAA8C;AAAA,uBAAKS,EAAET,cAAF,EAAL;AAAA,aAA9C,CAApB;;AAEA,gBAAMwB,oBAAoB,sBACtBzB,WADsB,EAEtB,UAAC0B,GAAD,EAAMhB,CAAN;AAAA,uBAAYI,OAAOC,MAAP,CAAcW,GAAd,EAAmBhB,CAAnB,CAAZ;AAAA,aAFsB,EAGtB,EAHsB,CAA1B;;AAMA,mBAAOe,iBAAP;AACH;;;;;;kBApEgBhC,Q;;;;;;;;;;;;;;;;;;yDCNZD,O;;;;;;;;;2DACAA,O;;;;;;;;;;;;;;;;;;;;;;6CCDAA,O;;;;;;AACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;ACDA;;;;AACA;;;;AACA;;;;;;;;IAEqBmC,Q;AACjB,sBAAYjC,MAAZ,EAAoB;AAAA;;AAChB,aAAKA,MAAL,GAAcA,MAAd;AACH;;;;kCAES8B,Q,EAAU;AAChB,gBAAMI,wBAA2B,KAAKlC,MAAL,CAAYmC,YAAvC,kBAAN;;AAEA,gBAAMjC,QAAQ,mBAAM,KAAKF,MAAL,CAAYE,KAAlB,EAAyB,UAACkC,QAAD,EAAc;AACjD,oBAAMC,WAAW,eAAKd,IAAL,CAAUO,QAAV,EAAoBM,QAApB,CAAjB;AACA,oBAAME,SAAS,aAAGC,YAAH,CAAgBF,QAAhB,EAA0B,MAA1B,CAAf;AACA,oBAAMG,cAAc,gBAAMC,MAAN,CAAa,QAAb,EAAuBP,qBAAvB,EAA8CI,MAA9C,CAApB;AACA,oBAAMlC,QAAQ,mBAAMoC,WAAN,EAAmB;AAAA,2BAAKxB,EAAE0B,SAAF,CAAY,CAAZ,EAAeC,KAApB;AAAA,iBAAnB,CAAd;;AAEA,uBAAO;AACHP,sCADG;AAEHC,sCAFG;AAGHjC,gCAHG;AAIHkC;AAJG,iBAAP;AAMH,aAZa,CAAd;;AAcA,iBAAKpC,KAAL,GAAaA,KAAb;;AAEA,mBAAOA,KAAP;AACH;;;6CAEoBS,O,EAASG,S,EAAW;AAAA;;AACrC,mCAAU,KAAKZ,KAAf,EAAsB,UAAC0C,OAAD,EAAa;AAC/B,oBAAMnB,SAAS,MAAKoB,gBAAL,CAAsBD,OAAtB,EAA+BjC,OAA/B,CAAf;;AAEA,6BAAGmC,aAAH,CACI,eAAKvB,IAAL,CAAUT,SAAV,EAAqB8B,QAAQR,QAA7B,CADJ,EAEIX,MAFJ;AAIH,aAPD;AAQH;;;yCAEgBmB,O,EAASjC,O,EAAS;AAC/B,gBAAMuB,wBAA2B,KAAKlC,MAAL,CAAYmC,YAAvC,kBAAN;AACA,gBAAMV,SAAS,gBAAME,OAAN,CAAc,QAAd,EAAwBO,qBAAxB,EACX,UAACa,MAAD,EAASC,IAAT;AAAA,uBAAkBC,KAAKC,SAAL,CAAevC,QAAQqC,KAAKN,SAAL,CAAe,CAAf,EAAkBC,KAA1B,CAAf,CAAlB;AAAA,aADW,EAEXC,QAAQN,MAFG,CAAf;;AAKA,mBAAOb,MAAP;AACH;;;;;;kBA9CgBQ,Q;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACJrB;;;;AACA;;;;AACA;;;;;;;;AAEA;AACA,IAAMkB,iBAAiB,SAAjBA,cAAiB,CAACC,GAAD,EAAMC,OAAN,EAAkB;AACrC,2BAAUA,OAAV,EAAmB,UAACV,KAAD,EAAQW,GAAR,EAAgB;AAC/B,YAAMC,SAASH,IAAIE,GAAJ,CAAf;;AAEA,YAAI,OAAOC,MAAP,KAAkB,WAAtB,EAAmC;AAC/B;AACH;;AAED,YAAI,6BAAcZ,KAAd,KAAwB,6BAAcY,MAAd,CAA5B,EAAmD;AAC/CJ,2BAAeI,MAAf,EAAuBZ,KAAvB;AACH,SAFD,MAEO;AACH,mBAAOS,IAAIE,GAAJ,CAAP;AACH;AACJ,KAZD;AAaH,CAdD;;AAgBA,IAAME,iBAAiB,SAAjBA,cAAiB,CAACJ,GAAD,EAAMC,OAAN,EAAkB;AACrC,2BAAUA,OAAV,EAAmB,UAACV,KAAD,EAAQW,GAAR,EAAgB;AAC/B,YAAMC,SAASH,IAAIE,GAAJ,CAAf;;AAEA,YAAI,OAAOC,MAAP,KAAkB,WAAtB,EAAmC;AAC/BH,gBAAIE,GAAJ,IAAWX,KAAX;;AAEA;AACH;;AAED,YAAI,6BAAcA,KAAd,KAAwB,6BAAcY,MAAd,CAA5B,EAAmD;AAC/CC,2BAAeD,MAAf,EAAuBZ,KAAvB;AACH,SAFD,MAEO;AACHS,gBAAIE,GAAJ,IAAWX,KAAX;AACH;AACJ,KAdD;AAeH,CAhBD;;IAkBqBc,U;AACjB,wBAAYzD,MAAZ,EAAoB;AAAA;;AAChB,aAAKA,MAAL,GAAcA,MAAd;AACH;;;;kCAES8B,Q,EAAU;AAChB,gBAAM1B,QAAQ,mBAAM,KAAKJ,MAAL,CAAY0D,OAAlB,EAA2B;AAAA,uBAAK1C,EAAE2C,IAAP;AAAA,aAA3B,CAAd;;AAEA,gBAAMzD,QAAQ,mBAAM,KAAKF,MAAL,CAAYE,KAAlB,EAAyB,UAACkC,QAAD,EAAc;AACjD,oBAAMC,WAAW,eAAKd,IAAL,CAAUO,QAAV,EAAoBM,QAApB,CAAjB;AACA,oBAAME,SAAS,aAAGC,YAAH,CAAgBF,QAAhB,EAA0B,MAA1B,CAAf;;AAEA,uBAAO;AACHD,sCADG;AAEHC,sCAFG;AAGHjC,gCAHG;AAIHkC;AAJG,iBAAP;AAMH,aAVa,CAAd;;AAYA,iBAAKpC,KAAL,GAAaA,KAAb;;AAEA,mBAAOA,KAAP;AACH;;;6CAEoBS,O,EAASG,S,EAAW;AAAA;;AACrC,mCAAU,KAAKZ,KAAf,EAAsB,UAAC0C,OAAD,EAAa;AAC/B,oBAAMnB,SAAS,MAAKoB,gBAAL,CAAsBD,OAAtB,EAA+BjC,OAA/B,CAAf;;AAEA,6BAAGmC,aAAH,CACI,eAAKvB,IAAL,CAAUT,SAAV,EAAqB8B,QAAQR,QAA7B,CADJ,EAEIX,MAFJ;AAIH,aAPD;AAQH;;;yCAEgBmB,O,EAASjC,O,EAAS;AAAA;;AAC/B,gBAAIiD,OAAOX,KAAKY,KAAL,CAAWjB,QAAQN,MAAnB,CAAX;;AAEAsB,mBAAO,sBAASjD,OAAT,EAAkB,UAACqB,GAAD,EAAMW,KAAN,EAAaW,GAAb,EAAqB;AAC1C,oBAAI,CAACX,KAAL,EAAY;AACR,2BAAOX,GAAP;AACH;;AAED,oBAAM0B,UAAU,sBAAS,OAAK1D,MAAL,CAAY0D,OAArB,EAA8B;AAAA,2BAAK1C,EAAE2C,IAAF,KAAWL,GAAhB;AAAA,iBAA9B,EAAmD,CAAnD,CAAhB;;AAEA,oBAAI,OAAOI,OAAP,KAAmB,WAAvB,EAAoC;AAChC,2BAAO1B,GAAP;AACH;;AAED,oBAAI0B,QAAQI,MAAZ,EAAoB;AAChBX,mCAAenB,GAAf,EAAoB0B,QAAQI,MAA5B;AACH;;AAED,oBAAIJ,QAAQK,MAAZ,EAAoB;AAChBP,mCAAexB,GAAf,EAAoB0B,QAAQK,MAA5B;AACH;;AAED,uBAAO/B,GAAP;AACH,aApBM,EAoBJ4B,IApBI,CAAP;;AAsBA,gBAAMnC,SAASwB,KAAKC,SAAL,CAAeU,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAAf;;AAEA,mBAAOnC,MAAP;AACH;;;;;;kBAhEgBgC,U;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvCrB;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;AAEA;AACA,IAAMN,iBAAiB,SAAjBA,cAAiB,CAACC,GAAD,EAAMC,OAAN,EAAkB;AACrC,2BAAUA,OAAV,EAAmB,UAACV,KAAD,EAAQW,GAAR,EAAgB;AAC/B,YAAMC,SAASH,IAAIE,GAAJ,CAAf;;AAEA,YAAI,OAAOC,MAAP,KAAkB,WAAtB,EAAmC;AAC/B;AACH;;AAED,YAAI,6BAAcZ,KAAd,KAAwB,6BAAcY,MAAd,CAA5B,EAAmD;AAC/CJ,2BAAeI,MAAf,EAAuBZ,KAAvB;AACH,SAFD,MAEO;AACH,mBAAOS,IAAIE,GAAJ,CAAP;AACH;AACJ,KAZD;AAaH,CAdD;;AAgBA,IAAME,iBAAiB,SAAjBA,cAAiB,CAACJ,GAAD,EAAMC,OAAN,EAAkB;AACrC,2BAAUA,OAAV,EAAmB,UAACV,KAAD,EAAQW,GAAR,EAAgB;AAC/B,YAAMC,SAASH,IAAIE,GAAJ,CAAf;;AAEA,YAAI,OAAOC,MAAP,KAAkB,WAAtB,EAAmC;AAC/BH,gBAAIE,GAAJ,IAAWX,KAAX;;AAEA;AACH;;AAED,YAAI,6BAAcA,KAAd,KAAwB,6BAAcY,MAAd,CAA5B,EAAmD;AAC/CC,2BAAeD,MAAf,EAAuBZ,KAAvB;AACH,SAFD,MAEO;AACHS,gBAAIE,GAAJ,IAAWX,KAAX;AACH;AACJ,KAdD;AAeH,CAhBD;;IAkBqBqB,U;AACjB,wBAAYhE,MAAZ,EAAoB;AAAA;;AAChB,aAAKA,MAAL,GAAcA,MAAd;AACH;;;;kCAES8B,Q,EAAU;AAChB,gBAAM1B,QAAQ,mBAAM,KAAKJ,MAAL,CAAY0D,OAAlB,EAA2B;AAAA,uBAAK1C,EAAE2C,IAAP;AAAA,aAA3B,CAAd;AACA,gBAAMzD,QAAQ,mBAAM,KAAKF,MAAL,CAAYE,KAAlB,EAAyB,UAACkC,QAAD,EAAc;AACjD,oBAAMC,WAAW,eAAKd,IAAL,CAAUO,QAAV,EAAoBM,QAApB,CAAjB;AACA,oBAAME,SAAS,aAAGC,YAAH,CAAgBF,QAAhB,EAA0B,MAA1B,EACVV,OADU,CACF,OADE,EACO,IADP,CAAf,CAFiD,CAGpB;;AAE7B,uBAAO;AACHS,sCADG;AAEHC,sCAFG;AAGHjC,gCAHG;AAIHkC;AAJG,iBAAP;AAMH,aAXa,CAAd;;AAaA,iBAAKpC,KAAL,GAAaA,KAAb;;AAEA,mBAAOA,KAAP;AACH;;;6CAEoBS,O,EAASG,S,EAAW;AAAA;;AACrC,mCAAU,KAAKZ,KAAf,EAAsB,UAAC0C,OAAD,EAAa;AAC/B,oBAAMnB,SAAS,MAAKoB,gBAAL,CAAsBD,OAAtB,EAA+BjC,OAA/B,CAAf;AACA,6BAAGmC,aAAH,CACI,eAAKvB,IAAL,CAAUT,SAAV,EAAqB8B,QAAQR,QAA7B,CADJ,EAEIX,MAFJ;AAIH,aAND;AAOH;;;yCAEgBmB,O,EAASjC,O,EAAS;AAAA;;AAC/B,gBAAIiD,OAAO,qBAAMhB,QAAQN,MAAd,EAAsBM,QAAQP,QAA9B,CAAX;;AAEAuB,mBAAO,sBAASjD,OAAT,EAAkB,UAACqB,GAAD,EAAMW,KAAN,EAAaW,GAAb,EAAqB;AAC1C,oBAAI,CAACX,KAAL,EAAY;AACR,2BAAOX,GAAP;AACH;;AAED,oBAAM0B,UAAU,sBAAS,OAAK1D,MAAL,CAAY0D,OAArB,EAA8B;AAAA,2BAAK1C,EAAE2C,IAAF,KAAWL,GAAhB;AAAA,iBAA9B,EAAmD,CAAnD,CAAhB;;AAEA,oBAAI,OAAOI,OAAP,KAAmB,WAAvB,EAAoC;AAChC,2BAAO1B,GAAP;AACH;;AAED,oBAAI0B,QAAQI,MAAZ,EAAoB;AAChBX,mCAAenB,GAAf,EAAoB0B,QAAQI,MAA5B;AACH;;AAED,oBAAIJ,QAAQK,MAAZ,EAAoB;AAChBP,mCAAexB,GAAf,EAAoB0B,QAAQK,MAA5B;AACH;;AAED,uBAAO/B,GAAP;AACH,aApBM,EAoBJ4B,IApBI,CAAP;;AAsBA,gBAAMnC,SAAS,yBAAUmC,IAAV,EAAgB,KAAhB,CAAf;;AAEA,mBAAOnC,MAAP;AACH;;;;;;kBA/DgBuC,U;;;;;;;;;;;;;;;;;IC1CAC,Y;AACjB,0BAAYjE,MAAZ,EAAoB;AAAA;;AAChB,aAAKA,MAAL,GAAcA,MAAd;AACH;;;;yCAEgB;AACb,mBAAO,KAAKA,MAAL,CAAYI,KAAnB;AACH;;;;;;kBAPgB6D,Y;;;;;;;;;;;;ACAd,IAAMC,oCAAc,SAAdA,WAAc,CAACC,QAAD,EAAW/D,KAAX,EAAqB;AAC5C,QAAIgE,WAAW,CAAf;;AAEA,SAAK,IAAIpD,IAAI,CAAb,EAAgBA,IAAImD,SAASE,MAA7B,EAAqCrD,KAAK,CAA1C,EAA6C;AACzC,YAAIZ,MAAM+D,SAASnD,CAAT,CAAN,CAAJ,EAAwB;AACpB;AACAoD,wBAAY,KAAKpD,CAAjB;AACH;AACJ;;AAED,WAAOoD,QAAP;AACH,CAXM;;AAaA,IAAME,kEAA6B,SAA7BA,0BAA6B,CAACH,QAAD,EAAgC;AAAA,QAArB7D,WAAqB,uEAAP,EAAO;;AACtE,QAAMiE,eAAenD,OAAOC,MAAP,CAAc,EAAd,EAAkBf,WAAlB,CAArB;AACA,QAAMkE,aAAa,EAAnB;;AAEA,QAAMC,oBAAoB,SAApBA,iBAAoB,CAAC7D,SAAD,EAAe;AACrC,YAAIA,aAAauD,SAASE,MAA1B,EAAkC;AAC9BG,uBAAWE,IAAX,CAAgBtD,OAAOC,MAAP,CAAc,EAAd,EAAkBkD,YAAlB,CAAhB;AACH,SAFD,MAEO;AACH,gBAAMZ,OAAOQ,SAASvD,SAAT,CAAb;AACA,gBAAI,OAAON,YAAYqD,IAAZ,CAAP,KAA6B,WAAjC,EAA8C;AAC1Cc,kCAAkB7D,YAAY,CAA9B;AACH,aAFD,MAEO;AACH2D,6BAAaZ,IAAb,IAAqB,KAArB;AACAc,kCAAkB7D,YAAY,CAA9B;AACA2D,6BAAaZ,IAAb,IAAqB,IAArB;AACAc,kCAAkB7D,YAAY,CAA9B;AACH;AACJ;AACJ,KAdD;;AAgBA6D,sBAAkB,CAAlB;;AAEA,WAAOD,UAAP;AACH,CAvBM;;AAyBP;AACO,IAAMG,gCAAY,SAAZA,SAAY;AAAA,WAAK3D,CAAL;AAAA,CAAlB,C;;;;;;ACvCP,kC;;;;;;ACAA,mC;;;;;;ACAA,oD;;;;;;ACAA,wD;;;;;;;;;;;;;;;;;;;ACCA;;;;AACA;;;;;;;;IAEqB4D,c;AACjB,4BAAY5E,MAAZ,EAAoB;AAAA;;AAChB,aAAKA,MAAL,GAAcA,MAAd;AACH;;;;oCAEWC,K,EAAO;AACf,gBAAM4E,6BAA6B,mBAAM5E,MAAMQ,gBAAZ,EAA8B,UAACE,OAAD,EAAUC,SAAV;AAAA,uBAC5D;AACGR,2BAAOO,OADV;AAEGmE,+BAAW7E,MAAMS,0BAAN,CAAiCE,SAAjC;AAFd,iBAD4D;AAAA,aAA9B,CAAnC;;AAOA,yBAAGkC,aAAH,CACI,eAAKvB,IAAL,CAAUtB,MAAMD,MAAN,CAAac,SAAvB,EAAkC,KAAKd,MAAL,CAAY4B,IAA9C,CADJ,EAEIqB,KAAKC,SAAL,CAAe2B,0BAAf,EAA2C,IAA3C,EAAiD,CAAjD,CAFJ;AAIH;;;;;;kBAjBgBD,c","file":"modelkit.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"fs\"), require(\"lodash/forEach\"), require(\"lodash/map\"), require(\"path\"), require(\"lodash/reduce\"), require(\"lodash/filter\"), require(\"lodash/flatten\"), require(\"lodash/isPlainObject\"), require(\"lodash/union\"), require(\"grasp\"), require(\"mkdirp\"), require(\"yarn/lib/lockfile/parse\"), require(\"yarn/lib/lockfile/stringify\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"modelkit\", [\"fs\", \"lodash/forEach\", \"lodash/map\", \"path\", \"lodash/reduce\", \"lodash/filter\", \"lodash/flatten\", \"lodash/isPlainObject\", \"lodash/union\", \"grasp\", \"mkdirp\", \"yarn/lib/lockfile/parse\", \"yarn/lib/lockfile/stringify\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"modelkit\"] = factory(require(\"fs\"), require(\"lodash/forEach\"), require(\"lodash/map\"), require(\"path\"), require(\"lodash/reduce\"), require(\"lodash/filter\"), require(\"lodash/flatten\"), require(\"lodash/isPlainObject\"), require(\"lodash/union\"), require(\"grasp\"), require(\"mkdirp\"), require(\"yarn/lib/lockfile/parse\"), require(\"yarn/lib/lockfile/stringify\"));\n\telse\n\t\troot[\"modelkit\"] = factory(root[\"fs\"], root[\"lodash/forEach\"], root[\"lodash/map\"], root[\"path\"], root[\"lodash/reduce\"], root[\"lodash/filter\"], root[\"lodash/flatten\"], root[\"lodash/isPlainObject\"], root[\"lodash/union\"], root[\"grasp\"], root[\"mkdirp\"], root[\"yarn/lib/lockfile/parse\"], root[\"yarn/lib/lockfile/stringify\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_4__, __WEBPACK_EXTERNAL_MODULE_5__, __WEBPACK_EXTERNAL_MODULE_6__, __WEBPACK_EXTERNAL_MODULE_7__, __WEBPACK_EXTERNAL_MODULE_8__, __WEBPACK_EXTERNAL_MODULE_18__, __WEBPACK_EXTERNAL_MODULE_19__, __WEBPACK_EXTERNAL_MODULE_20__, __WEBPACK_EXTERNAL_MODULE_21__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap eabb236badedc718f3f6","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"lodash/forEach\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/forEach\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"lodash/map\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/map\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"lodash/reduce\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/reduce\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"lodash/filter\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/filter\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"lodash/flatten\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/flatten\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"lodash/isPlainObject\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isPlainObject\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"lodash/union\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/union\"\n// module id = 8\n// module chunks = 0","export { default as ModelkitJsonLoader } from './modelkit-json-loader';\r\nexport { default as ModelkitJsLoader } from './modelkit-js-loader';\r\nexport { default as ModelkitYarnLoader } from './modelkit-yarn-loader';\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/index.js","import * as _ from 'lodash';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\nimport mkdirp from 'mkdirp';\r\nimport { getBooleanFlagPermutations, sortFlags } from './utils/flag-utils';\r\n\r\nexport default class Modelkit {\r\n    run(config) {\r\n        const state = {\r\n            config,\r\n        };\r\n\r\n        // TODO: refactor. Extract files reading from fs here.\r\n        state.files = this.readFiles(config);\r\n        state.flags = this.getFlags(state);\r\n\r\n        // Extract permutations into plugin.\r\n        const freezeFlags = this.getFreezeFlags(config.plugins);\r\n        state.flagPermutations = sortFlags(getBooleanFlagPermutations(state.flags, freezeFlags));\r\n        state.flagPermutationDirectories = _.map(\r\n            state.flagPermutations,\r\n            (flagObj, flagIndex) => this.getDirectoryByFlag({ flagObj, flagIndex, config }),\r\n        );\r\n\r\n        mkdirp(config.outputDir);\r\n\r\n        _.forEach(_.filter(config.plugins.filter(i => i.getManifest)), i => i.getManifest(state));\r\n\r\n        _.forEach(state.flagPermutations, (flagObj, flagIndex) => {\r\n            this.applyFlagsToAllFiles({ flagObj, flagIndex, config });\r\n        });\r\n    }\r\n\r\n    applyFlagsToAllFiles({ flagObj, flagIndex, config }) {\r\n        // TODO: refactor. Extract files writing here.\r\n        const flagCopy = Object.assign({}, flagObj);\r\n        // TODO: allow plugins to provide additional replacements in filename\r\n        const flagDirectory = this.getDirectoryByFlag({ flagObj, flagIndex, config });\r\n        const outputDir = path.join(config.outputDir, flagDirectory);\r\n\r\n        mkdirp(outputDir);\r\n        _.forEach(config.input, i => i.applyFlagsToAllFiles(flagCopy, outputDir));\r\n    }\r\n\r\n    getDirectoryByFlag({ flagIndex, config }) {\r\n        // TODO: allow plugins to provide additional replacements in filename\r\n        const result = config.flagDirName.replace('[id]', flagIndex);\r\n        return result;\r\n    }\r\n\r\n    getFlags(state) {\r\n        // we support only boolean flags for now\r\n        // hence union and returning flag names only works fine\r\n        const flags = _.union(_.flatten(_.map(state.files, file => file.flags)));\r\n        return flags;\r\n    }\r\n\r\n    readFiles(config) {\r\n        const files = _.flatten(_.map(config.input, loader => loader.readFiles(config.inputDir)));\r\n        return files;\r\n    }\r\n\r\n    getFreezeFlags(input) {\r\n        // TODO: check if there are different values assigned for the same flags.\r\n        // Throw if there are.\r\n        const freezeFlags = _.map(_.filter(input, i => i.getFreezeFlags), i => i.getFreezeFlags());\r\n\r\n        const uniqueFreezeFlags = _.reduce(\r\n            freezeFlags,\r\n            (agg, i) => Object.assign(agg, i),\r\n            {},\r\n        );\r\n\r\n        return uniqueFreezeFlags;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/modelkit.js","export { default as ModelkitFreezePlugin } from './modelkit-freeze-plugin';\nexport { default as ModelkitManifestPlugin } from './modelkit-manifest-plugin';\n\n\n\n// WEBPACK FOOTER //\n// ./src/plugins/index.js","export { default } from './modelkit';\r\nexport * from './plugins';\r\nexport * from './loaders';\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import * as _ from 'lodash';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport grasp from 'grasp';\r\n\r\nexport default class JsLoader {\r\n    constructor(config) {\r\n        this.config = config;\r\n    }\r\n\r\n    readFiles(inputDir) {\r\n        const functionSearchPattern = `${this.config.flagFunction}(_str, _bool)`;\r\n\r\n        const files = _.map(this.config.files, (fileName) => {\r\n            const filePath = path.join(inputDir, fileName);\r\n            const source = fs.readFileSync(filePath, 'utf8');\r\n            const foundResult = grasp.search('equery', functionSearchPattern, source);\r\n            const flags = _.map(foundResult, i => i.arguments[0].value);\r\n\r\n            return {\r\n                fileName,\r\n                filePath,\r\n                flags,\r\n                source,\r\n            };\r\n        });\r\n\r\n        this.files = files;\r\n\r\n        return files;\r\n    }\r\n\r\n    applyFlagsToAllFiles(flagObj, outputDir) {\r\n        _.forEach(this.files, (fileObj) => {\r\n            const result = this.applyFlagsToFile(fileObj, flagObj);\r\n\r\n            fs.writeFileSync(\r\n                path.join(outputDir, fileObj.fileName),\r\n                result,\r\n            );\r\n        });\r\n    }\r\n\r\n    applyFlagsToFile(fileObj, flagObj) {\r\n        const functionSearchPattern = `${this.config.flagFunction}(_str, _bool)`;\r\n        const result = grasp.replace('equery', functionSearchPattern,\r\n            (getRaw, node) => JSON.stringify(flagObj[node.arguments[0].value]),\r\n            fileObj.source,\r\n        );\r\n\r\n        return result;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/modelkit-js-loader.js","import * as _ from 'lodash';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport isPlainObject from 'lodash/isPlainObject';\r\n\r\n// No array support atm.\r\nconst deleteProperty = (obj, pattern) => {\r\n    _.forEach(pattern, (value, key) => {\r\n        const subObj = obj[key];\r\n\r\n        if (typeof subObj === 'undefined') {\r\n            return;\r\n        }\r\n\r\n        if (isPlainObject(value) && isPlainObject(subObj)) {\r\n            deleteProperty(subObj, value);\r\n        } else {\r\n            delete obj[key];\r\n        }\r\n    });\r\n};\r\n\r\nconst updateProperty = (obj, pattern) => {\r\n    _.forEach(pattern, (value, key) => {\r\n        const subObj = obj[key];\r\n\r\n        if (typeof subObj === 'undefined') {\r\n            obj[key] = value;\r\n\r\n            return;\r\n        }\r\n\r\n        if (isPlainObject(value) && isPlainObject(subObj)) {\r\n            updateProperty(subObj, value);\r\n        } else {\r\n            obj[key] = value;\r\n        }\r\n    });\r\n};\r\n\r\nexport default class JsonLoader {\r\n    constructor(config) {\r\n        this.config = config;\r\n    }\r\n\r\n    readFiles(inputDir) {\r\n        const flags = _.map(this.config.changes, i => i.flag);\r\n\r\n        const files = _.map(this.config.files, (fileName) => {\r\n            const filePath = path.join(inputDir, fileName);\r\n            const source = fs.readFileSync(filePath, 'utf8');\r\n\r\n            return {\r\n                fileName,\r\n                filePath,\r\n                flags,\r\n                source,\r\n            };\r\n        });\r\n\r\n        this.files = files;\r\n\r\n        return files;\r\n    }\r\n\r\n    applyFlagsToAllFiles(flagObj, outputDir) {\r\n        _.forEach(this.files, (fileObj) => {\r\n            const result = this.applyFlagsToFile(fileObj, flagObj);\r\n\r\n            fs.writeFileSync(\r\n                path.join(outputDir, fileObj.fileName),\r\n                result,\r\n            );\r\n        });\r\n    }\r\n\r\n    applyFlagsToFile(fileObj, flagObj) {\r\n        let json = JSON.parse(fileObj.source);\r\n\r\n        json = _.reduce(flagObj, (agg, value, key) => {\r\n            if (!value) {\r\n                return agg;\r\n            }\r\n\r\n            const changes = _.filter(this.config.changes, i => i.flag === key)[0];\r\n\r\n            if (typeof changes === 'undefined') {\r\n                return agg;\r\n            }\r\n\r\n            if (changes.delete) {\r\n                deleteProperty(agg, changes.delete);\r\n            }\r\n\r\n            if (changes.update) {\r\n                updateProperty(agg, changes.update);\r\n            }\r\n\r\n            return agg;\r\n        }, json);\r\n\r\n        const result = JSON.stringify(json, null, 2);\r\n\r\n        return result;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/modelkit-json-loader.js","import * as _ from 'lodash';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport isPlainObject from 'lodash/isPlainObject';\r\nimport parse from 'yarn/lib/lockfile/parse';\r\nimport stringify from 'yarn/lib/lockfile/stringify';\r\n\r\n// No array support atm.\r\nconst deleteProperty = (obj, pattern) => {\r\n    _.forEach(pattern, (value, key) => {\r\n        const subObj = obj[key];\r\n\r\n        if (typeof subObj === 'undefined') {\r\n            return;\r\n        }\r\n\r\n        if (isPlainObject(value) && isPlainObject(subObj)) {\r\n            deleteProperty(subObj, value);\r\n        } else {\r\n            delete obj[key];\r\n        }\r\n    });\r\n};\r\n\r\nconst updateProperty = (obj, pattern) => {\r\n    _.forEach(pattern, (value, key) => {\r\n        const subObj = obj[key];\r\n\r\n        if (typeof subObj === 'undefined') {\r\n            obj[key] = value;\r\n\r\n            return;\r\n        }\r\n\r\n        if (isPlainObject(value) && isPlainObject(subObj)) {\r\n            updateProperty(subObj, value);\r\n        } else {\r\n            obj[key] = value;\r\n        }\r\n    });\r\n};\r\n\r\nexport default class YarnLoader {\r\n    constructor(config) {\r\n        this.config = config;\r\n    }\r\n\r\n    readFiles(inputDir) {\r\n        const flags = _.map(this.config.changes, i => i.flag);\r\n        const files = _.map(this.config.files, (fileName) => {\r\n            const filePath = path.join(inputDir, fileName);\r\n            const source = fs.readFileSync(filePath, 'utf8')\r\n                .replace(/\\r\\n/g, '\\n'); // important for yarn parser\r\n\r\n            return {\r\n                fileName,\r\n                filePath,\r\n                flags,\r\n                source,\r\n            };\r\n        });\r\n\r\n        this.files = files;\r\n\r\n        return files;\r\n    }\r\n\r\n    applyFlagsToAllFiles(flagObj, outputDir) {\r\n        _.forEach(this.files, (fileObj) => {\r\n            const result = this.applyFlagsToFile(fileObj, flagObj);\r\n            fs.writeFileSync(\r\n                path.join(outputDir, fileObj.fileName),\r\n                result,\r\n            );\r\n        });\r\n    }\r\n\r\n    applyFlagsToFile(fileObj, flagObj) {\r\n        let json = parse(fileObj.source, fileObj.filePath);\r\n\r\n        json = _.reduce(flagObj, (agg, value, key) => {\r\n            if (!value) {\r\n                return agg;\r\n            }\r\n\r\n            const changes = _.filter(this.config.changes, i => i.flag === key)[0];\r\n\r\n            if (typeof changes === 'undefined') {\r\n                return agg;\r\n            }\r\n\r\n            if (changes.delete) {\r\n                deleteProperty(agg, changes.delete);\r\n            }\r\n\r\n            if (changes.update) {\r\n                updateProperty(agg, changes.update);\r\n            }\r\n\r\n            return agg;\r\n        }, json);\r\n\r\n        const result = stringify(json, false);\r\n\r\n        return result;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/modelkit-yarn-loader.js","export default class FreezePlugin {\r\n    constructor(config) {\r\n        this.config = config;\r\n    }\r\n\r\n    getFreezeFlags() {\r\n        return this.config.flags;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/plugins/modelkit-freeze-plugin.js","export const getFlagBits = (flagList, flags) => {\r\n    let flagBits = 0;\r\n\r\n    for (let i = 0; i < flagList.length; i += 1) {\r\n        if (flags[flagList[i]]) {\r\n            /* eslint-disable no-bitwise */\r\n            flagBits += 1 << i;\r\n        }\r\n    }\r\n\r\n    return flagBits;\r\n};\r\n\r\nexport const getBooleanFlagPermutations = (flagList, freezeFlags = {}) => {\r\n    const currentFlags = Object.assign({}, freezeFlags);\r\n    const resultList = [];\r\n\r\n    const changeFlagByIndex = (flagIndex) => {\r\n        if (flagIndex >= flagList.length) {\r\n            resultList.push(Object.assign({}, currentFlags));\r\n        } else {\r\n            const flag = flagList[flagIndex];\r\n            if (typeof freezeFlags[flag] !== 'undefined') {\r\n                changeFlagByIndex(flagIndex + 1);\r\n            } else {\r\n                currentFlags[flag] = false;\r\n                changeFlagByIndex(flagIndex + 1);\r\n                currentFlags[flag] = true;\r\n                changeFlagByIndex(flagIndex + 1);\r\n            }\r\n        }\r\n    };\r\n\r\n    changeFlagByIndex(0);\r\n\r\n    return resultList;\r\n};\r\n\r\n// TODO: sort flags\r\nexport const sortFlags = i => i;\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/flag-utils.js","module.exports = require(\"grasp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"grasp\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"mkdirp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mkdirp\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"yarn/lib/lockfile/parse\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"yarn/lib/lockfile/parse\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"yarn/lib/lockfile/stringify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"yarn/lib/lockfile/stringify\"\n// module id = 21\n// module chunks = 0","import * as _ from 'lodash';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\nexport default class ManifestPlugin {\r\n    constructor(config) {\r\n        this.config = config;\r\n    }\r\n\r\n    getManifest(state) {\r\n        const featureFlagsToDirectoryMap = _.map(state.flagPermutations, (flagObj, flagIndex) =>\r\n            ({\r\n                flags: flagObj,\r\n                directory: state.flagPermutationDirectories[flagIndex],\r\n            }),\r\n        );\r\n\r\n        fs.writeFileSync(\r\n            path.join(state.config.outputDir, this.config.file),\r\n            JSON.stringify(featureFlagsToDirectoryMap, null, 2),\r\n        );\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/plugins/modelkit-manifest-plugin.js"],"sourceRoot":""}