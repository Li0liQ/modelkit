{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 692db5d68083f5650983","webpack:///external \"fs\"","webpack:///external \"lodash/forEach\"","webpack:///external \"lodash/map\"","webpack:///external \"path\"","webpack:///external \"lodash/reduce\"","webpack:///external \"lodash/filter\"","webpack:///external \"lodash/flatten\"","webpack:///external \"lodash/isPlainObject\"","webpack:///external \"lodash/union\"","webpack:///./src/loaders/index.js","webpack:///./src/modelkit.js","webpack:///./src/plugins/index.js","webpack:///./src/index.js","webpack:///./src/loaders/modelkit-js-loader.js","webpack:///./src/loaders/modelkit-json-loader.js","webpack:///./src/loaders/modelkit-yarn-loader.js","webpack:///./src/plugins/modelkit-freeze-plugin.js","webpack:///./src/utils/flag-utils.js","webpack:///external \"grasp\"","webpack:///external \"mkdirp\"","webpack:///external \"yarn/lib/lockfile/parse\"","webpack:///external \"yarn/lib/lockfile/stringify\""],"names":["default","Modelkit","config","readFiles","flags","getFlags","freezeFlags","getFreezeFlags","plugins","flagPermutations","sortedFlags","outputDir","featureFlagsToDirectoryMap","flagObj","flagIndex","directory","getDirectoryByFlag","writeFileSync","join","JSON","stringify","applyFlags","flagCopy","Object","assign","flagDirectory","input","i","result","flagDirName","replace","inputDir","uniqueFreezeFlags","agg","JsLoader","functionSearchPattern","flagFunction","files","fileName","filePath","source","readFileSync","foundResult","search","arguments","value","getRaw","node","deleteProperty","obj","pattern","key","subObj","updateProperty","JsonLoader","changes","flag","json","parse","delete","update","YarnLoader","FreezePlugin","getFlagBits","flagList","flagBits","length","getBooleanFlagPermutations","currentFlags","resultList","changeFlagByIndex","push","sortFlags"],"mappings":"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","file":"modelkit.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"fs\"), require(\"lodash/forEach\"), require(\"lodash/map\"), require(\"path\"), require(\"lodash/reduce\"), require(\"lodash/filter\"), require(\"lodash/flatten\"), require(\"lodash/isPlainObject\"), require(\"lodash/union\"), require(\"grasp\"), require(\"mkdirp\"), require(\"yarn/lib/lockfile/parse\"), require(\"yarn/lib/lockfile/stringify\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"modelkit\", [\"fs\", \"lodash/forEach\", \"lodash/map\", \"path\", \"lodash/reduce\", \"lodash/filter\", \"lodash/flatten\", \"lodash/isPlainObject\", \"lodash/union\", \"grasp\", \"mkdirp\", \"yarn/lib/lockfile/parse\", \"yarn/lib/lockfile/stringify\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"modelkit\"] = factory(require(\"fs\"), require(\"lodash/forEach\"), require(\"lodash/map\"), require(\"path\"), require(\"lodash/reduce\"), require(\"lodash/filter\"), require(\"lodash/flatten\"), require(\"lodash/isPlainObject\"), require(\"lodash/union\"), require(\"grasp\"), require(\"mkdirp\"), require(\"yarn/lib/lockfile/parse\"), require(\"yarn/lib/lockfile/stringify\"));\n\telse\n\t\troot[\"modelkit\"] = factory(root[\"fs\"], root[\"lodash/forEach\"], root[\"lodash/map\"], root[\"path\"], root[\"lodash/reduce\"], root[\"lodash/filter\"], root[\"lodash/flatten\"], root[\"lodash/isPlainObject\"], root[\"lodash/union\"], root[\"grasp\"], root[\"mkdirp\"], root[\"yarn/lib/lockfile/parse\"], root[\"yarn/lib/lockfile/stringify\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_3__, __WEBPACK_EXTERNAL_MODULE_4__, __WEBPACK_EXTERNAL_MODULE_5__, __WEBPACK_EXTERNAL_MODULE_6__, __WEBPACK_EXTERNAL_MODULE_7__, __WEBPACK_EXTERNAL_MODULE_8__, __WEBPACK_EXTERNAL_MODULE_18__, __WEBPACK_EXTERNAL_MODULE_19__, __WEBPACK_EXTERNAL_MODULE_20__, __WEBPACK_EXTERNAL_MODULE_21__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 692db5d68083f5650983","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"lodash/forEach\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/forEach\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"lodash/map\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/map\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"lodash/reduce\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/reduce\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"lodash/filter\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/filter\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"lodash/flatten\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/flatten\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"lodash/isPlainObject\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/isPlainObject\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"lodash/union\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash/union\"\n// module id = 8\n// module chunks = 0","export { default as ModelkitJsonLoader } from './modelkit-json-loader';\r\nexport { default as ModelkitJsLoader } from './modelkit-js-loader';\r\nexport { default as ModelkitYarnLoader } from './modelkit-yarn-loader';\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/index.js","import * as _ from 'lodash';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\nimport mkdirp from 'mkdirp';\r\nimport { getBooleanFlagPermutations, sortFlags } from './utils/flag-utils';\r\n\r\nexport default class Modelkit {\r\n    run(config) {\r\n        // Copy the way to handle plugins and provide events from webpack. Later.\r\n\r\n        this.readFiles(config);\r\n        const flags = this.getFlags(config);\r\n        const freezeFlags = this.getFreezeFlags(config.plugins);\r\n        const flagPermutations = getBooleanFlagPermutations(flags, freezeFlags);\r\n\r\n        // TODO: allow plugins to sort flags the way they want\r\n        const sortedFlags = sortFlags(flagPermutations);\r\n\r\n        mkdirp(config.outputDir);\r\n\r\n        // Write a plugin that will create a manifest file.\r\n        const featureFlagsToDirectoryMap = _.map(sortedFlags, (flagObj, flagIndex) =>\r\n            ({\r\n                flags: flagObj,\r\n                directory: this.getDirectoryByFlag({ flagObj, flagIndex, config }),\r\n            }),\r\n        );\r\n\r\n        fs.writeFileSync(\r\n            path.join(config.outputDir, 'mapping.json'),\r\n            JSON.stringify(featureFlagsToDirectoryMap, null, 2),\r\n        );\r\n\r\n        _.forEach(sortedFlags, (flagObj, flagIndex) => {\r\n            this.applyFlags({ flagObj, flagIndex, config });\r\n        });\r\n    }\r\n\r\n    applyFlags({ flagObj, flagIndex, config }) {\r\n        const flagCopy = Object.assign({}, flagObj);\r\n        // TODO: allow plugins to provide additional replacements in filename\r\n        const flagDirectory = this.getDirectoryByFlag({ flagObj, flagIndex, config });\r\n        const outputDir = path.join(config.outputDir, flagDirectory);\r\n\r\n        mkdirp(outputDir);\r\n        _.forEach(config.input, i => i.applyFlags(flagCopy, outputDir));\r\n    }\r\n\r\n    getDirectoryByFlag({ flagIndex, config }) {\r\n        // TODO: allow plugins to provide additional replacements in filename\r\n        const result = config.flagDirName.replace('[id]', flagIndex);\r\n        return result;\r\n    }\r\n\r\n    getFlags(config) {\r\n        // we support only boolean flags for now\r\n        // hence union and returning flag names only works fine\r\n        const flags = _.union(\r\n            _.flatten(\r\n                _.map(config.input, i => i.getFlags()),\r\n            ),\r\n        );\r\n\r\n        return flags;\r\n    }\r\n\r\n    readFiles(config) {\r\n        _.forEach(config.input, i => i.readFiles(config.inputDir));\r\n    }\r\n\r\n    getFreezeFlags(input) {\r\n        // TODO: check if there are different values assigned for the same flags.\r\n        // Throw if there are.\r\n        const freezeFlags = _.map(input, i => i.getFreezeFlags());\r\n\r\n        const uniqueFreezeFlags = _.reduce(\r\n            freezeFlags,\r\n            (agg, i) => Object.assign(agg, i),\r\n            {},\r\n        );\r\n\r\n        return uniqueFreezeFlags;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/modelkit.js","export { default as ModelkitFreezePlugin } from './modelkit-freeze-plugin';\n\n\n\n// WEBPACK FOOTER //\n// ./src/plugins/index.js","export { default } from './modelkit';\r\nexport * from './plugins';\r\nexport * from './loaders';\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import * as _ from 'lodash';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport grasp from 'grasp';\r\n\r\nexport default class JsLoader {\r\n    constructor(config) {\r\n        this.config = config;\r\n    }\r\n\r\n    readFiles(inputDir) {\r\n        const functionSearchPattern = `${this.config.flagFunction}(_str, _bool)`;\r\n\r\n        this.files = _.map(this.config.files, (fileName) => {\r\n            const filePath = path.join(inputDir, fileName);\r\n            const source = fs.readFileSync(filePath, 'utf8');\r\n            const foundResult = grasp.search('equery', functionSearchPattern, source);\r\n            const flags = _.map(foundResult, i => i.arguments[0].value);\r\n\r\n            return {\r\n                fileName,\r\n                filePath,\r\n                flags,\r\n                source,\r\n            };\r\n        });\r\n    }\r\n\r\n    getFlags() {\r\n        const flags = _.union(\r\n            _.flatten(\r\n                _.map(this.files, i => i.flags),\r\n            ),\r\n        );\r\n\r\n        return flags;\r\n    }\r\n\r\n    applyFlags(flagObj, outputDir) {\r\n        const functionSearchPattern = `${this.config.flagFunction}(_str, _bool)`;\r\n\r\n        _.forEach(this.files, ({ fileName, source }) => {\r\n            const result = grasp.replace('equery', functionSearchPattern,\r\n                (getRaw, node) => JSON.stringify(flagObj[node.arguments[0].value]),\r\n                source,\r\n            );\r\n\r\n            fs.writeFileSync(\r\n                path.join(outputDir, fileName),\r\n                result,\r\n            );\r\n        });\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/modelkit-js-loader.js","import * as _ from 'lodash';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport isPlainObject from 'lodash/isPlainObject';\r\n\r\n// No array support atm.\r\nconst deleteProperty = (obj, pattern) => {\r\n    _.forEach(pattern, (value, key) => {\r\n        const subObj = obj[key];\r\n\r\n        if (typeof subObj === 'undefined') {\r\n            return;\r\n        }\r\n\r\n        if (isPlainObject(value) && isPlainObject(subObj)) {\r\n            deleteProperty(subObj, value);\r\n        } else {\r\n            delete obj[key];\r\n        }\r\n    });\r\n};\r\n\r\nconst updateProperty = (obj, pattern) => {\r\n    _.forEach(pattern, (value, key) => {\r\n        const subObj = obj[key];\r\n\r\n        if (typeof subObj === 'undefined') {\r\n            obj[key] = value;\r\n\r\n            return;\r\n        }\r\n\r\n        if (isPlainObject(value) && isPlainObject(subObj)) {\r\n            updateProperty(subObj, value);\r\n        } else {\r\n            obj[key] = value;\r\n        }\r\n    });\r\n};\r\n\r\nexport default class JsonLoader {\r\n    constructor(config) {\r\n        this.config = config;\r\n    }\r\n\r\n    readFiles(inputDir) {\r\n        this.files = _.map(this.config.files, (fileName) => {\r\n            const filePath = path.join(inputDir, fileName);\r\n            const source = fs.readFileSync(filePath, 'utf8');\r\n\r\n            return {\r\n                fileName,\r\n                filePath,\r\n                source,\r\n            };\r\n        });\r\n    }\r\n\r\n    getFlags() {\r\n        const flags = _.map(this.config.changes, i => i.flag);\r\n\r\n        return flags;\r\n    }\r\n\r\n    applyFlags(flagObj, outputDir) {\r\n        _.forEach(this.files, ({ fileName, source }) => {\r\n            let json = JSON.parse(source);\r\n\r\n            json = _.reduce(flagObj, (agg, value, key) => {\r\n                if (!value) {\r\n                    return agg;\r\n                }\r\n\r\n                const changes = _.filter(this.config.changes, i => i.flag === key)[0];\r\n\r\n                if (typeof changes === 'undefined') {\r\n                    return agg;\r\n                }\r\n\r\n                if (changes.delete) {\r\n                    deleteProperty(agg, changes.delete);\r\n                }\r\n\r\n                if (changes.update) {\r\n                    updateProperty(agg, changes.update);\r\n                }\r\n\r\n                return agg;\r\n            }, json);\r\n\r\n            fs.writeFileSync(\r\n                path.join(outputDir, fileName),\r\n                JSON.stringify(json, null, 2),\r\n            );\r\n        });\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/modelkit-json-loader.js","import * as _ from 'lodash';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\nimport isPlainObject from 'lodash/isPlainObject';\r\nimport parse from 'yarn/lib/lockfile/parse';\r\nimport stringify from 'yarn/lib/lockfile/stringify';\r\n\r\n// No array support atm.\r\nconst deleteProperty = (obj, pattern) => {\r\n    _.forEach(pattern, (value, key) => {\r\n        const subObj = obj[key];\r\n\r\n        if (typeof subObj === 'undefined') {\r\n            return;\r\n        }\r\n\r\n        if (isPlainObject(value) && isPlainObject(subObj)) {\r\n            deleteProperty(subObj, value);\r\n        } else {\r\n            delete obj[key];\r\n        }\r\n    });\r\n};\r\n\r\nconst updateProperty = (obj, pattern) => {\r\n    _.forEach(pattern, (value, key) => {\r\n        const subObj = obj[key];\r\n\r\n        if (typeof subObj === 'undefined') {\r\n            obj[key] = value;\r\n\r\n            return;\r\n        }\r\n\r\n        if (isPlainObject(value) && isPlainObject(subObj)) {\r\n            updateProperty(subObj, value);\r\n        } else {\r\n            obj[key] = value;\r\n        }\r\n    });\r\n};\r\n\r\nexport default class YarnLoader {\r\n    constructor(config) {\r\n        this.config = config;\r\n    }\r\n\r\n    readFiles(inputDir) {\r\n        this.files = _.map(this.config.files, (fileName) => {\r\n            const filePath = path.join(inputDir, fileName);\r\n            const source = fs.readFileSync(filePath, 'utf8')\r\n                .replace(/\\r\\n/g, '\\n'); // important for yarn parser\r\n\r\n            return {\r\n                fileName,\r\n                filePath,\r\n                source,\r\n            };\r\n        });\r\n    }\r\n\r\n    getFlags() {\r\n        const flags = _.map(this.config.changes, i => i.flag);\r\n\r\n        return flags;\r\n    }\r\n\r\n    applyFlags(flagObj, outputDir) {\r\n        _.forEach(this.files, ({ fileName, filePath, source }) => {\r\n            let json = parse(source, filePath);\r\n            json = _.reduce(flagObj, (agg, value, key) => {\r\n                if (!value) {\r\n                    return agg;\r\n                }\r\n\r\n                const changes = _.filter(this.config.changes, i => i.flag === key)[0];\r\n\r\n                if (typeof changes === 'undefined') {\r\n                    return agg;\r\n                }\r\n\r\n                if (changes.delete) {\r\n                    deleteProperty(agg, changes.delete);\r\n                }\r\n\r\n                if (changes.update) {\r\n                    updateProperty(agg, changes.update);\r\n                }\r\n\r\n                return agg;\r\n            }, json);\r\n\r\n            fs.writeFileSync(\r\n                path.join(outputDir, fileName),\r\n                stringify(json, false),\r\n            );\r\n        });\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/modelkit-yarn-loader.js","export default class FreezePlugin {\r\n    constructor(config) {\r\n        this.config = config;\r\n    }\r\n\r\n    getFreezeFlags() {\r\n        return this.config.flags;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/plugins/modelkit-freeze-plugin.js","export const getFlagBits = (flagList, flags) => {\r\n    let flagBits = 0;\r\n\r\n    for (let i = 0; i < flagList.length; i += 1) {\r\n        if (flags[flagList[i]]) {\r\n            /* eslint-disable no-bitwise */\r\n            flagBits += 1 << i;\r\n        }\r\n    }\r\n\r\n    return flagBits;\r\n};\r\n\r\nexport const getBooleanFlagPermutations = (flagList, freezeFlags = {}) => {\r\n    const currentFlags = Object.assign({}, freezeFlags);\r\n    const resultList = [];\r\n\r\n    const changeFlagByIndex = (flagIndex) => {\r\n        if (flagIndex >= flagList.length) {\r\n            resultList.push(Object.assign({}, currentFlags));\r\n        } else {\r\n            const flag = flagList[flagIndex];\r\n            if (typeof freezeFlags[flag] !== 'undefined') {\r\n                changeFlagByIndex(flagIndex + 1);\r\n            } else {\r\n                currentFlags[flag] = false;\r\n                changeFlagByIndex(flagIndex + 1);\r\n                currentFlags[flag] = true;\r\n                changeFlagByIndex(flagIndex + 1);\r\n            }\r\n        }\r\n    };\r\n\r\n    changeFlagByIndex(0);\r\n\r\n    return resultList;\r\n};\r\n\r\n// TODO: sort flags\r\nexport const sortFlags = i => i;\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils/flag-utils.js","module.exports = require(\"grasp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"grasp\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"mkdirp\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mkdirp\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"yarn/lib/lockfile/parse\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"yarn/lib/lockfile/parse\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"yarn/lib/lockfile/stringify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"yarn/lib/lockfile/stringify\"\n// module id = 21\n// module chunks = 0"],"sourceRoot":""}